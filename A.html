<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8">
  <title>X√¢y d·ª±ng c·∫•u h√¨nh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --main: #2b90ef;
      --dark: #1f2937;
      --line: #e5e7eb;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: 'Times New Roman', serif;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0 20px;
    }

    .cost {
      font-weight: bold;
      color: #2b90ef;
    }


    .page {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }

    .title {
      font-size: 22px;
      font-weight: bold;
    }

    .row {
      display: flex;
      border-top: 1px solid var(--line);
    }

    /* D√≤ng l·∫ª */
    .row:nth-child(odd) {
      background-color: #ffffff;
    }

    /* D√≤ng ch·∫µn */
    .row:nth-child(even) {
      background-color: #f3f4f6;
    }

    /* Hover  */
    .row:hover {
      background-color: #e5f0ff;
    }


    .cell-left {
      width: 220px;
      padding: 10px;
      font-weight: bold;
    }

    .cell-right {
      flex: 1;
      padding: 10px;
    }

    .pick {
      background: var(--main);
      color: #fff;
      border: none;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: bold;
    }

    .cost {
      margin: 10px 0;
      color: var(--main);
      font-weight: bold;
    }

    .btn {
      background: var(--main);
      color: #fff;
      border: none;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: bold;
    }

    /* Overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .5);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal {
      background: #fff;
      width: 500px;
      max-width: 90%;
      padding: 15px;
    }

    .item {
      border: 1px solid var(--line);
      padding: 10px;
      margin-bottom: 8px;
    }

    .item button {
      float: right;
      background: var(--main);
      color: #fff;
      border: none;
      padding: 4px 10px;
      cursor: pointer;
    }

    .action-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .action-btn {
      background: #ef4444;
      color: #fff;
      border: none;
      padding: 10px 14px;
      font-weight: bold;
      cursor: pointer;
      white-space: nowrap;
    }

    .action-btn:hover {
      background: #dc2626;
    }

    .saved-item {
      border: 1px solid var(--line);
      padding: 10px;
      margin-bottom: 10px;
    }

    .saved-item b {
      color: var(--dark);
    }

    .saved-item button {
      margin-right: 6px;
      padding: 6px 10px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-load {
      background: #16a34a;
      color: #fff;
    }

    .btn-delete {
      background: #dc2626;
      color: #fff;
    }

    .cart-bar {
      position: fixed;
      top: 0;
      right: 0;
      background: hsl(0, 0%, 100%);
      color: #da5e0b;
      padding: 10px 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 9999;
      border-bottom-left-radius: 6px;
      cursor: pointer;
    }

    .cart-icon {
      background: #e63d3d;
      color: #fff;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body>

  <div class="page">
    <div class="title">CH·ªåN LINH KI·ªÜN X√ÇY D·ª∞NG C·∫§U H√åNH</div>

    <div class="topbar">
      <button class="btn" onclick="openReset()">L√ÄM M·ªöI</button>
      <div class="cost" id="total">Chi ph√≠ d·ª± t√≠nh: 0 ƒë</div>
    </div>


    <div id="list"></div>
    <hr style="margin:40px 0">

    <h3>C·∫§U H√åNH ƒê√É L∆ØU</h3>
    <div id="savedBuilds"></div>

  </div>
  <!-- CART BAR -->
  <div id="cartBar" class="cart-bar" onclick="openCart()">
    <span class="cart-icon">üõí</span>
    <span>Gi·ªè h√†ng (<span id="cartCount">0</span>)</span>
  </div>

  <!-- CART OVERLAY -->
  <div class="overlay" id="cartOverlay">
    <div class="modal" style="width:600px; max-height:80vh; overflow:auto">
      <h3 style="margin-top:0">GI·ªé H√ÄNG</h3>

      <div id="cartList"></div>

      <hr>
      <div id="cartTotal" style="font-weight:bold"></div>

      <div style="text-align:right;margin-top:15px">
        <button class="btn" style="background:#9ca3af" onclick="closeCart()">ƒê√≥ng</button>
      </div>
    </div>
  </div>


  <!-- OVERLAY -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h3 id="modalTitle"></h3>
      <div id="modalList"></div>
      <button class="btn" onclick="closeModal()">ƒê√≥ng</button>
    </div>
  </div>
  <!-- RESET MODAL -->
  <div class="overlay" id="resetOverlay">
    <div class="modal">
      <h3 style="margin-top:0">L√ÄM M·ªöI</h3>
      <p>
        C·∫£nh b√°o: To√†n b·ªô linh ki·ªán c·ªßa b·ªô PC hi·ªán t·∫°i s·∫Ω b·ªã x√≥a ƒëi
      </p>

      <div style="text-align:right;margin-top:20px">
        <button class="btn" style="background:#9ca3af" onclick="closeReset()">H·ª¶Y</button>
        <button class="btn" style="background:#dc2626" onclick="confirmReset()">X√ÅC NH·∫¨N</button>
      </div>
    </div>
  </div>
  <!-- DELETE PART MODAL -->
  <div class="overlay" id="deleteOverlay">
    <div class="modal">
      <h3 style="margin-top:0">X√ìA LINH KI·ªÜN</h3>
      <p id="deleteText">B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a linh ki·ªán n√†y?</p>

      <div style="text-align:right;margin-top:20px">
        <button class="btn" style="background:#9ca3af" onclick="closeDelete()">H·ª¶Y</button>
        <button class="btn" style="background:#dc2626" onclick="confirmDelete()">X√ÅC NH·∫¨N</button>
      </div>
    </div>
  </div>


  <!-- EXPORT IMAGE ONLY SELECTED PARTS -->
  <div id="exportImageArea" style="
  position: fixed;
  left: -9999px;
  top: 0;
  width: 800px;
  background: #ffffff;
  padding: 20px;
  font-family: 'Times New Roman', serif;
">
    <h2 style="margin-top:0">C·∫§U H√åNH PC ƒê√É CH·ªåN</h2>
    <div id="exportList"></div>
    <hr>
    <div id="exportTotal" style="font-weight:bold"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const PARTS = [
      { key: "cpu", label: "B·ªô vi x·ª≠ l√Ω" },
      { key: "main", label: "Bo m·∫°ch ch·ªß" },
      { key: "ram", label: "RAM" },
      { key: "ssd", label: "SSD" },
      { key: "hdd", label: "HDD" },
      { key: "vga", label: "VGA" },
      { key: "psu", label: "Ngu·ªìn" },
      { key: "case", label: "V·ªè case" },
      { key: "monitor", label: "M√†n h√¨nh" },
      { key: "keyboard", label: "B√†n ph√≠m" },
      { key: "mouse", label: "Chu·ªôt" },
      { key: "headset", label: "Tai nghe" },
      { key: "fan", label: "Fan case" },
      { key: "aircool", label: "T·∫£n nhi·ªát kh√≠" },
      { key: "aio", label: "T·∫£n nhi·ªát n∆∞·ªõc AIO" },
      { key: "custom", label: "T·∫£n nhi·ªát n∆∞·ªõc Custom" },
      { key: "windows", label: "Windows b·∫£n quy·ªÅn" }
    ];


    const DATA = {
      cpu: [
        { name: "Intel Core i5-12400F", price: 3500000 },
        { name: "AMD Ryzen 5 5600X", price: 3900000 }
      ],
      main: [
        { name: "B660M", price: 2200000 },
        { name: "B760M", price: 2900000 }
      ],
      ram: [
        { name: "16GB DDR4", price: 1200000 },
        { name: "32GB DDR4", price: 2200000 }
      ],
      ssd: [
        { name: "SSD 512GB", price: 1300000 },
        { name: "SSD 1TB", price: 2300000 }
      ],
      hdd: [
        { name: "HDD 1TB", price: 900000 },
        { name: "HDD 2TB", price: 1500000 }
      ],
      vga: [
        { name: "RTX 3060", price: 7500000 },
        { name: "RTX 4060", price: 9500000 }
      ],
      psu: [
        { name: "650W Bronze", price: 1200000 },
        { name: "750W Gold", price: 1800000 }
      ],
      case: [
        { name: "Case Mid Tower", price: 1000000 },
        { name: "Case Full Tower", price: 1800000 }
      ],
      monitor: [
        { name: "24 inch FHD", price: 3000000 },
        { name: "27 inch QHD", price: 5200000 }
      ],
      keyboard: [
        { name: "Ph√≠m c∆°", price: 600000 },
        { name: "Ph√≠m vƒÉn ph√≤ng", price: 300000 }
      ],
      mouse: [
        { name: "Chu·ªôt gaming", price: 400000 },
        { name: "Chu·ªôt vƒÉn ph√≤ng", price: 200000 }
      ],
      headset: [
        { name: "Tai nghe gaming", price: 800000 },
        { name: "Tai nghe th∆∞·ªùng", price: 400000 }
      ],
      fan: [
        { name: "Fan RGB", price: 300000 },
        { name: "Fan th∆∞·ªùng", price: 150000 }
      ],
      aircool: [
        { name: "T·∫£n kh√≠ Cooler Master", price: 700000 },
        { name: "T·∫£n kh√≠ Noctua", price: 1500000 }
      ],
      aio: [
        { name: "AIO 240mm", price: 2500000 },
        { name: "AIO 360mm", price: 4200000 }
      ],
      custom: [
        { name: "Custom c∆° b·∫£n", price: 5000000 },
        { name: "Custom cao c·∫•p", price: 9000000 }
      ],
      windows: [
        { name: "Windows 11 Home", price: 1200000 },
        { name: "Windows 11 Pro", price: 2500000 }
      ]
    };


    let build = JSON.parse(localStorage.getItem("pc_build")) || {};
    let currentKey = "";
    let deleteKey = "";
    function render() {
      let html = "";
      let total = 0;

      PARTS.forEach(p => {
        html += `
      <div class="row">
        <div class="cell-left">${p.label}</div>
        <div class="cell-right">
          <button class="pick" onclick="clickPart('${p.key}')">
            ${build[p.key] ? build[p.key].name + " ‚ùå" : "+ Ch·ªçn " + p.label}
          </button>
        </div>
      </div>
    `;
        if (build[p.key]) total += build[p.key].price;
      });
      /* ===== ACTION BAR ===== */
      html += `
        <div class="row">
          <div class="cell-right">
            <div class="action-bar">
              <button class="action-btn" onclick="saveBuild()"> L∆ØU C·∫§U H√åNH</button>
              <button class="action-btn" onclick="exportExcel()">T·∫¢I FILE EXCEL C·∫§U H√åNH</button>
              <button class="action-btn" onclick="exportImage()"> T·∫¢I ·∫¢NH</button>
              <button class="action-btn" onclick="shareBuild()">CHIA S·∫∫ C·∫§U H√åNH</button>
              <button class="action-btn" onclick="printBuild()">XEM V√Ä IN</button>
              <button class="action-btn" onclick="addToCart()">TH√äM V√ÄO GI·ªé H√ÄNG</button>
            </div>
          </div>
        </div>
      `;

      document.getElementById("list").innerHTML = html;
      document.getElementById("total").innerText =
        "Chi ph√≠ d·ª± t√≠nh: " + total.toLocaleString() + " ƒë";
    }

    function clickPart(key) {
      if (build[key]) {
        deleteKey = key;
        document.getElementById("deleteText").innerText =
          "B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a " + build[key].name + " ?";
        openDelete();
      } else {
        openModal(key);
      }
    }



    function openModal(key) {
      currentKey = key;
      document.getElementById("modalTitle").innerText =
        "Ch·ªçn " + PARTS.find(p => p.key === key).label;
      let list = "";
      DATA[key].forEach(i => {
        list += `
      <div class="item">
        <b>${i.name}</b> - ${i.price.toLocaleString()} ƒë
        <button onclick="selectItem('${i.name}',${i.price})">Ch·ªçn</button>
      </div>
    `;
      });
      document.getElementById("modalList").innerHTML = list;
      document.getElementById("overlay").style.display = "flex";
    }

    function selectItem(name, price) {
      build[currentKey] = { name, price };
      save();
      closeModal();
    }

    function closeModal() {
      document.getElementById("overlay").style.display = "none";
    }

    function save() {
      localStorage.setItem("pc_build", JSON.stringify(build));
      render();
    }
    function openReset() {
      document.getElementById("resetOverlay").style.display = "flex";
    }

    function closeReset() {
      document.getElementById("resetOverlay").style.display = "none";
    }
    function saveBuild() {
      if (Object.keys(build).length === 0) return;

      const saved = JSON.parse(localStorage.getItem("saved_builds")) || [];

      const newBuild = {
        id: Date.now(),
        time: new Date().toLocaleString(),
        build: JSON.parse(JSON.stringify(build))
      };

      saved.push(newBuild);
      localStorage.setItem("saved_builds", JSON.stringify(saved));

      renderSavedBuilds();
    }

    function renderSavedBuilds() {
      const saved = JSON.parse(localStorage.getItem("saved_builds")) || [];
      let html = "";

      if (saved.length === 0) {
        document.getElementById("savedBuilds").innerHTML =
          "<i>Ch∆∞a c√≥ c·∫•u h√¨nh n√†o ƒë∆∞·ª£c l∆∞u</i>";
        return;
      }

      saved.forEach(s => {
        let total = 0;
        let items = "";

        for (const k in s.build) {
          total += s.build[k].price;
          items += `<div>- ${s.build[k].name}</div>`;
        }

        html += `
      <div class="saved-item">
        <b>Th·ªùi gian:</b> ${s.time}<br>
        <b>T·ªïng ti·ªÅn:</b> ${total.toLocaleString()} ƒë
        ${items}
        <div style="margin-top:8px">
          <button class="btn-load" onclick="loadBuild(${s.id})">Xem l·∫°i</button>
          <button class="btn-delete" onclick="deleteSavedBuild(${s.id})">X√≥a</button>
        </div>
      </div>
    `;
      });

      document.getElementById("savedBuilds").innerHTML = html;
    }

    function loadBuild(id) {
      const saved = JSON.parse(localStorage.getItem("saved_builds")) || [];
      const item = saved.find(s => s.id === id);
      if (!item) return;

      build = JSON.parse(JSON.stringify(item.build));
      save();
    }

    function deleteSavedBuild(id) {
      let saved = JSON.parse(localStorage.getItem("saved_builds")) || [];
      saved = saved.filter(s => s.id !== id);
      localStorage.setItem("saved_builds", JSON.stringify(saved));
      renderSavedBuilds();
    }
    function openDelete() {
      document.getElementById("deleteOverlay").style.display = "flex";
    }

    function closeDelete() {
      document.getElementById("deleteOverlay").style.display = "none";
      deleteKey = "";
    }

    function confirmDelete() {
      if (deleteKey) {
        delete build[deleteKey];
        save();
      }
      closeDelete();
    }

    function confirmReset() {
      localStorage.removeItem("pc_build");
      build = {};
      render();
      closeReset();
    }
    function exportExcel() {
      if (Object.keys(build).length === 0) return;

      // Chu·∫©n b·ªã d·ªØ li·ªáu cho Excel
      const rows = [
        ["Danh m·ª•c", "Linh ki·ªán", "Gi√° (VND)"]
      ];

      let total = 0;

      for (const key in build) {
        const part = PARTS.find(p => p.key === key);
        rows.push([
          part ? part.label : key,
          build[key].name,
          build[key].price
        ]);
        total += build[key].price;
      }

      rows.push([]);
      rows.push(["", "T·ªîNG TI·ªÄN", total]);

      // T·∫°o workbook & worksheet
      const ws = XLSX.utils.aoa_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Cau_hinh_PC");

      // T√™n file
      const fileName = "Cau_hinh_PC_" + Date.now() + ".xlsx";

      // Xu·∫•t file
      XLSX.writeFile(wb, fileName);
    }
    function exportImage() {
      const listEl = document.getElementById("exportList");
      const totalEl = document.getElementById("exportTotal");

      listEl.innerHTML = "";
      totalEl.innerHTML = "";

      let total = 0;

      for (const key in build) {
        const part = PARTS.find(p => p.key === key);
        const item = build[key];

        const row = document.createElement("div");
        row.style.marginBottom = "8px";
        row.innerHTML = `
      <b>${part ? part.label : key}:</b>
      ${item.name}
      <span style="float:right">${item.price.toLocaleString()} ƒë</span>
    `;

        listEl.appendChild(row);
        total += item.price;
      }

      totalEl.innerHTML = "T·ªîNG TI·ªÄN: " + total.toLocaleString() + " ƒë";

      const target = document.getElementById("exportImageArea");

      html2canvas(target, {
        scale: 2,
        backgroundColor: "#ffffff"
      }).then(canvas => {
        const link = document.createElement("a");
        link.download = "Cau_hinh_PC_da_chon.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }
    function shareBuild() {
      if (Object.keys(build).length === 0) {
        alert("Ch∆∞a c√≥ c·∫•u h√¨nh ƒë·ªÉ chia s·∫ª");
        return;
      }

      const encoded = btoa(
        encodeURIComponent(JSON.stringify(build))
      );

      const shareUrl =
        window.location.origin +
        "/view?config=" +
        encoded;

      // üëâ CHUY·ªÇN TRANG LU√îN
      window.location.href = shareUrl;
    }



    function printBuild() {
      // In trang hi·ªán t·∫°i (tr√¨nh duy·ªát m·ªü h·ªôp tho·∫°i in)
      window.print();
    }

    function addToCart() {
      if (Object.keys(build).length === 0) {
        alert("B·∫°n ch∆∞a ch·ªçn linh ki·ªán n√†o!");
        return;
      }

      const cart = JSON.parse(localStorage.getItem("cart_builds")) || [];

      cart.push({
        id: Date.now(),
        time: new Date().toLocaleString(),
        build: JSON.parse(JSON.stringify(build))
      });

      localStorage.setItem("cart_builds", JSON.stringify(cart));

      updateCartCount();
    }
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart_builds")) || [];
      document.getElementById("cartCount").innerText = cart.length;
    }
    function openCart() {
      renderCart();
      document.getElementById("cartOverlay").style.display = "flex";
    }

    function closeCart() {
      document.getElementById("cartOverlay").style.display = "none";
    }

    function renderCart() {
      const cart = JSON.parse(localStorage.getItem("cart_builds")) || [];
      const listEl = document.getElementById("cartList");
      const totalEl = document.getElementById("cartTotal");

      listEl.innerHTML = "";
      totalEl.innerHTML = "";

      if (cart.length === 0) {
        listEl.innerHTML = "<i>Gi·ªè h√†ng tr·ªëng</i>";
        return;
      }

      let grandTotal = 0;

      cart.forEach((item, index) => {
        let total = 0;
        let html = `<div style="border:1px solid #e5e7eb;padding:10px;margin-bottom:10px">
      <b>C·∫•u h√¨nh ${index + 1}</b>
      <div style="font-size:13px;color:#6b7280">${item.time}</div>`;

        for (const key in item.build) {
          html += `<div>- ${item.build[key].name}</div>`;
          total += item.build[key].price;
        }

        grandTotal += total;

        html += `
      <div style="margin-top:6px;font-weight:bold">
        T·ªïng: ${total.toLocaleString()} ƒë
      </div>
      <button class="btn-delete" style="margin-top:8px"
        onclick="removeCartItem(${index})">X√≥a</button>
    </div>`;

        listEl.innerHTML += html;
      });

      totalEl.innerText = "T·ªîNG TI·ªÄN GI·ªé H√ÄNG: " + grandTotal.toLocaleString() + " ƒë";
    }
    function removeCartItem(index) {
      let cart = JSON.parse(localStorage.getItem("cart_builds")) || [];
      cart.splice(index, 1);
      localStorage.setItem("cart_builds", JSON.stringify(cart));
      updateCartCount();
      renderCart();
    }



    render();
    renderSavedBuilds();
    updateCartCount();



  </script>


</body>

</html>